---
title: "PEC_3_SAD"
author: "Joel Calero Rodriguez y Manuel Rosario Marín Fernández"
date: "27/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

# Apartado 1

#### Estudiar la respuesta inmunologica innata ex vivo en dos poblaciones de macrofagos (bazo y peritoneo) frente a diferentes antigenos del tratamiento. Las muestras fueron tomadas del modelo murino que recibieron el tratamiento alternativo (A) y el de referencia (B). Para estudiar el efecto del tumor en la respuesta innata, tambien se le suministro el tratamiento A y B en animales sin cancer. 
* ¿A que antigeno responden mas los macrofagos?
* ¿Responden los macrofagos a los mismos antigenos que se encuentran en el peritoneo y en el bazo? 
* ¿La presencia de tumor en los animales modifica la respuesta a los distintos antigenos?
   
#####  - A: Tratamiento A con tumor
#####  - B: Tratamiento A sin tumor
#####  - C: Tratamiento B con tumor
#####  - D: Tratamiento B sin tumor
#####  - I: Animal control con tumor
#####  - J: Animal control sin tumor:

```{r ej1, echo=FALSE}
folderPath <- c(getwd(),"/","DataBase_PEC3.csv") ## Leer ruta para cargar base de datos
csvFile <- paste0(folderPath,collapse = "")
dataMurine <- read.csv(csvFile,header = TRUE, sep = ",") ## Introducir datos

```

## Apartado 2

Texto aquí

```{r ej2}
head(dataMurine) # Mostrar datos

summary(dataMurine) # Significado de cada variable

str(dataMurine) # Tipo de valores de cada variable

## Dar nombre a los grupos para facilitar la comprension
groupNames <- factor(dataMurine$Grupo, levels = c("A","B","C","D","I","J"),labels = c("Tratamiento A con tumor","Tratamiento A sin tumor","Tratamiento B con tumor","Tratamiento B sin tumor","Animal control con tumor","Animal control sin tumor") )  
unique(groupNames) ## Comprobar que los labels estan introducidos correctamente
```

## Apartado 3
```{r}
# ?Cuantos valores N/A se encuentran en la Base de Datos? 
# Creo que se piden cuestiones como estas
cat("Existen un total de",table(!is.na(dataMurine))["FALSE"],"valores N/A en la base de datos") # Contar valores N/A

# Calcular la media de la reestimulacion de cada grupo
# Boxplot con los valores de reestimulacion por grupos


```


## Apartado 4

#### Realizar un análisis descriptivo de los datos. El análisis debe incluir (tal y como aparece en la Sección 3 de la PEC1) un resumen paramétrico de los datos y su representación gráfica, que mejor defina y complemente cada una de dichas variables. 
```{r}
#cambios de clase a ciertas variables para poder trabajar con ellas, de manera más clara
dataMurine$Grupo <- factor(dataMurine$Grupo, levels = c("A","B","C","D","I","J"))  
dataMurine$Región<- factor(dataMurine$Región,levels = c("Peritoneo", "Bazo"))
dataMurine$Antígeno<- factor(dataMurine$Antígeno,levels = c("1", "2","3"))
dataMurine=na.omit(dataMurine)# eliminación de valores NA
summary(dataMurine) #resumen parametrico de las variables
``` 
#### A continuación una representación de las diferentes variables:

``` {r}
par(mfrow=c(2,2))
plot(dataMurine$Antígeno, col = "cyan", xlab= "Antígeno") # el número de individuos por antigeno utilizado


plot(dataMurine$Grupo, col = "dark red", xlab= "Grupos") # el numero de individuos de cada grupo

plot(dataMurine$Región,col= "yellow", xlab= "Región") #el numero de individuos por región


plot(dataMurine$Grupo,dataMurine$Reestimulación,type='o', col = "green", xlab= "Grupos", ylab= "Reestimulación") #la reestimulación por cada grupo del estudio
```


#### Media por tratamientos (grupos A, B, C, D, I, J):
```{r, echo= FALSE}

dataMurine$Grupo <- factor(dataMurine$Grupo, levels = c("A","B","C","D","I","J"),labels = c("Tratamiento A con tumor","Tratamiento A sin tumor","Tratamiento B con tumor","Tratamiento B sin tumor","Animal control con tumor","Animal control sin tumor") )  #cambio de los caracteres por labels para mejor lectura de los datos

aggregate(dataMurine[, 5], list(dataMurine$Grupo), mean) #medias de reestimulación por grupo


```


## Apartado 5
#### Complementando el apartado anterior, elaborar un análisis de regresión de dos conjuntos de variables (LAB2 y Ejercicio 6 de la PEC1). La elección de las variables, los resultados, así como su relación deben de estar correctamente justificada.
```{r}
str(dataMurine)
```

```{r}
summary(dataMurine)
```

```{r}
dataMurine$Grupo<-as.numeric(dataMurine$Grupo)
dataMurine$Región<-as.numeric(dataMurine$Región)
dataMurine$Antígeno<-as.numeric(dataMurine$Antígeno)
summary(dataMurine) 
```

```{r}
cor(x=dataMurine[2:5],method="pearson"); pairs(dataMurine[2:5]) #Tenemos en cuenta solo las variables no los IDs de los ratones ya que no aportan nada ahora mismo
```

```{r}
murine_rl=lm(formula= Reestimulación~Grupo,data=dataMurine)
summary(murine_rl)
```
#### Representación del conjunto de variables:
```{r ,echo= FALSE}
opar <- par(no.readonly = TRUE)

par(mar = c(5, 5, 4, 14))
plot(dataMurine$Grupo,dataMurine$Reestimulación, xlab="Grupo", ylab="Reestimulación")
abline(murine_rl)
legend(x = "topright",inset = c(-0.8,0),legend=c("1= Tratamiento A con tumor","2= Tratamiento A sin tumor","3= Tratamiento B con tumor","4= Tratamiento B sin tumor","5= Animal control con tumor","6= Animal control sin tumor"), xpd = TRUE)
on.exit(par(opar))
```

```{r}
murine_rm<-lm(dataMurine$Reestimulación~dataMurine$Grupo + dataMurine$Región+dataMurine$Antígeno,data=dataMurine[2:5])
summary(murine_rm)
```

```{r}
step(object=murine_rm,direction ="both", trace=1) # Análisis de los mejores predictores 
```

```{r}
#Se obtiene el modelo de regresión con los mejores predictores
murine_rm<-lm(formula = dataMurine$Reestimulación~dataMurine$Región + dataMurine$Antígeno, data = dataMurine[2:5])
summary(murine_rm)
```

```{r}
#definimos los vectores de las variables lage y lbase y los guardamos en un dataframe
antigeno_murine<-c(dataMurine$Antígeno)
raton_murine<-c(+dataMurine$Ratón)
df_murine<-data.frame(antigeno_murine,raton_murine)
#Primeros registros:
head(df_murine)
```

```{r}
table(df_murine$antigeno_murine) # diferencias en número de observaciones
```

```{r}
aggregate(raton_murine~antigeno_murine,data=df_murine,FUN=mean) # calculo de media de edad en función de trt
```

```{r}
boxplot(raton_murine~antigeno_murine,data=df_murine,id.method="y")
```

```{r}
require(nortest)
by(data=df_murine,INDICES = df_murine$antigeno_murine,FUN=function(x){lillie.test(x$raton_murine )})
```

```{r}
library(MASS)
library(cluster)
d_agl_murine<-dist(dataMurine,method="euclidean")
hc_agl_murine<-hclust(d_agl_murine,method="complete") 
plot(hc_agl_murine,cex=0.6,hang=-1, main ="Dendograma de cluster") 
```

```{r}
##Agrupamiento divisional jerárquico.
hc_agl_murine<-agnes(dataMurine,method="complete") 
pltree(hc_agl_murine,cex=0.6,hang=-1,main="Dendograma de agnes") 

```

#### Coeficiente de aglomeración
```{r, echo=FALSE}
hc_agl_murine$ac 
```

##### Coeficiente próximo a 1

#### Agrupamiento divisional jerárquico
```{r}

hc_div_murine<-diana(dataMurine) ##calculamos los clústeres jerárquicos
pltree(hc_div_murine,cex=0.6,hang=-1,main="Dendograma de Diana") 
```

### Coeficiente de división:
```{r}
hc_div_murine$dc # coeficiente también próximo a 1
```

```{r}
pltree(hc_div_murine,hang=-1,cex=0.6)
rect.hclust(hc_div_murine,k=10,border=2:10) # por último se asocian los agrupamiento de datos
```

## Apartado 6 
```{r}

```



## Apartado 7
#### Complementando el apartado anterior, elaborar un análisis ANOVA de dos conjuntos de variables (LAB5 y Ejercicio 6 de la PEC2). La elección de las variables, los resultados, así como su relación deben de estar correctamente justificada. Además, realizar una prueba cluster de las variables, y si existe un fuerte agrupamiento, elaborar un dendograma (LAB5).


```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```




## Apartado 8
```{r}

```



